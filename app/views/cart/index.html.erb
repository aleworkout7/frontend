<div class="container">

	<form class="new_order" id="new_order" action="/orders" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="XNUm34UuTWi8d5kEi+SB7kqPNs7KjGYTMw82Rk8OqNAk0jvE4IuqWlnZpJ15RI/GQguRmaV6+xLXqB+bRI2nEw==" />
		<div style="margin: 5%">
			<div class="modal-header">
				<h4 class="modal-title" id="small-modal-label">Carro de Compra</h4>
			</div>

			<div class="modal-body">
				<div>
					<div class="table table-striped table-hover">

						<input value="1" type="hidden" name="order[shop_id]" id="order_shop_id" />

						<% @cart.each do |product| %>
							<div class="row">
								<div align="center" class="col-sm-2">
									<div style="margin-bottom: 0px;">
										<%= image_tag(product.image_url, width: 60, height: 60, class: "img-responsive aspect") if product.image? %>
									</div>
								</div>
								<div align="center" class="col-sm-4">
									<input value="2" type="hidden" name="order[order_products_attributes][0][product_id]" id="order_order_products_attributes_0_product_id">
									<%= product.name %>
								</div>
								<div align="center" class="col-sm-2">
									<input value="20" type="hidden" name="order[order_products_attributes][0][unit_price]" id="order_order_products_attributes_0_unit_price">
									$ <%= product.price %>
								</div>

								<div align="center" class="col-sm-3">
									<div class="center">
										<div class="input-group">
											<span class="input-group-btn">
												<button type="button" class="btn btn-danger btn-number"  data-type="minus" data-field="order[order_products_attributes][0][quantity]">
													<span class="glyphicon glyphicon-minus"></span>
												</button>
											</span>
											<input value="1" type="text" name="order[order_products_attributes][0][quantity]" id="order_order_products_attributes_0_quantity", class="form-control input-number" min="1" max="100">
											<span class="input-group-btn">
												<button type="button" class="btn btn-success btn-number" data-type="plus" data-field="order[order_products_attributes][0][quantity]">
													<span class="glyphicon glyphicon-plus"></span>
												</button>
											</span>
										</div>
									</div>
								</div>

								<div align="center" class="col-sm-1">
									<%= link_to "Remove", remove_from_cart_shop_path(@shop, product), "data-confirm": "Are you sure?", "data-method": "delete" %>
								</div>
							</div>
							<hr/>
						<% end %>

					</div>
				</div>
			</div>
			<div  class="modal-footer">
				<div class="row actions">
					<div align="center" class="col-sm-12">
						<%= link_to "Vaciar carro", clear_cart_shop_path(@shop), class: "btn btn-primary", "data-toggle": "modal", "data-target": "#vacia-modal" %>
						<%= link_to "Continuar comprando", shop_path(@shop), class: "btn" %>
						<%= submit_tag "Confirmar pedido", name: nil, class: "btn btn-success", disable_with: "Confirmando...", "data-confirm": "Seguro desea confimar el pedido" %>
					</div>
				</div>
			</div>
		</div>
	</form>

	<%= render partial: "modal_clear_cart" %>

	<style type="text/css">
	.center{
		width: 130px;
	}

	hr {
		display: block;
		height: 1px;
		border: 0;
		border-top: 1px solid #eee;
		margin: 1em 0;
		padding: 0;
	}
	</style>

	<script type="text/javascript">

	//plugin bootstrap minus and plus
	//http://jsfiddle.net/laelitenetwork/puJ6G/
	$('.btn-number').click(function(e){
		e.preventDefault();

		fieldName = $(this).attr('data-field');
		type      = $(this).attr('data-type');
		var input = $("input[name='"+fieldName+"']");
		var currentVal = parseInt(input.val());
		if (!isNaN(currentVal)) {
			if(type == 'minus') {

				if(currentVal > input.attr('min')) {
					input.val(currentVal - 1).change();
				}
				if(parseInt(input.val()) == input.attr('min')) {
					$(this).attr('disabled', true);
				}

			} else if(type == 'plus') {

				if(currentVal < input.attr('max')) {
					input.val(currentVal + 1).change();
				}
				if(parseInt(input.val()) == input.attr('max')) {
					$(this).attr('disabled', true);
				}

			}
		} else {
			input.val(0);
		}
	});
	$('.input-number').focusin(function(){
		$(this).data('oldValue', $(this).val());
	});
	$('.input-number').change(function() {

		minValue =  parseInt($(this).attr('min'));
		maxValue =  parseInt($(this).attr('max'));
		valueCurrent = parseInt($(this).val());

		name = $(this).attr('name');
		if(valueCurrent >= minValue) {
			$(".btn-number[data-type='minus'][data-field='"+name+"']").removeAttr('disabled')
		} else {
			alert('Sorry, the minimum value was reached');
			$(this).val($(this).data('oldValue'));
		}
		if(valueCurrent <= maxValue) {
			$(".btn-number[data-type='plus'][data-field='"+name+"']").removeAttr('disabled')
		} else {
			alert('Sorry, the maximum value was reached');
			$(this).val($(this).data('oldValue'));
		}


	});
	$(".input-number").keydown(function (e) {
		// Allow: backspace, delete, tab, escape, enter and .
		if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 190]) !== -1 ||
		// Allow: Ctrl+A
		(e.keyCode == 65 && e.ctrlKey === true) ||
		// Allow: home, end, left, right
		(e.keyCode >= 35 && e.keyCode <= 39)) {
			// let it happen, don't do anything
			return;
		}
		// Ensure that it is a number and stop the keypress
		if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
			e.preventDefault();
		}
	});


	</script>
</div>
